<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>I Need Resell</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="apple-touch-icon" href="logo1.png" />

  <style>
    :root{
      --primary:#6f57d3; --bg:#f2f2f7; --fg:#111; --border:#d9d9de;
      --r:14px; --pad:18px; --maxw:420px;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow-x: hidden;   /* 🔒 empêche le scroll horizontal */
      overflow-y: auto;
      background: var(--bg);
      color: var(--fg);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      -webkit-text-size-adjust: 100%;
      overscroll-behavior: none; /* 🔒 empêche les rebonds sur iPhone */
    }

    .wrap {
      width: 100%;
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 0 var(--pad) 24px;
      box-sizing: border-box;
      overflow: hidden; /* 🔒 bloque tout débordement éventuel */
    }

    /* GIF ENTIER + BORDS ARRONDIS, SANS SCROLL */
    .hero {
      display: block;
      width: 100%;
      max-width: 100%;
      height: auto;
      border-radius: 18px;
      margin: 14px auto 10px;
      background: transparent;
      object-fit: contain;   /* garde tout le GIF sans l’étirer */
    }

    h1 {font-size:24px; font-weight:800; margin:10px 0 6px;}
    label {display:block; font-size:16px; font-weight:800; margin:14px 0 8px;}
    input, select {
      width:100%;
      box-sizing:border-box;
      background:#fff;
      border:1px solid var(--border);
      border-radius:var(--r);
      padding:14px 16px;
      font-size:16px;
      min-height:48px;
      outline:none;
      -webkit-appearance:none;
      appearance:none;
    }
    input:focus,select:focus {
      border-color:#c7b8ff;
      box-shadow:0 0 0 3px rgba(111,87,211,.15);
    }

    .row {display:flex; gap:14px;}
    .row .field {flex:1; min-width:0; display:flex; flex-direction:column;}

    .select-wrap {position:relative;}
    .select-wrap::after {
      content:""; position:absolute; right:14px; top:50%; width:14px; height:14px;
      transform:translateY(-50%);
      pointer-events:none;
      background:no-repeat center/contain url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%23007AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');
    }

    .hint {font-size:13px; color:#666; margin-top:6px;}

    .actions {
      padding:14px 0 calc(env(safe-area-inset-bottom,0) + 14px);
    }

    #submit {
      width:100%;
      height:60px;
      border:none;
      border-radius:16px;
      background:var(--primary);
      color:#fff;
      font-size:20px;
      font-weight:800;
      letter-spacing:.2px;
      box-shadow:0 10px 24px rgba(111,87,211,.25);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      cursor:pointer;
    }
    #submit:disabled {opacity:.6; cursor:default;}
    .spinner {
      width:18px; height:18px; border-radius:50%;
      border:3px solid rgba(255,255,255,.35); border-top-color:#fff;
      animation:spin .8s linear infinite;
    }
    @keyframes spin {to {transform:rotate(360deg);}}

    .bloc {display:none;}
    .bloc.active {display:block;}

    .switchline {display:flex; align-items:center; gap:8px; margin-top:6px;}
    .switchline input[type="checkbox"] {
      transform:scale(.9);
      width:22px; height:22px;
    }

    @media (max-width:360px){ .row{flex-direction:column;} }
  </style>
</head>
<body>
  <div class="wrap">
    <img src="go.gif" alt="I Need Resell" class="hero" />

    <main>
      <label>Type de transaction</label>
      <div class="select-wrap">
        <select id="type">
          <option>Achat stock</option>
          <option>Frais annexes</option>
          <option>Vente/Cashout</option>
          <option>Abonnement (mensuel)</option>
          <option>Paiement</option>
        </select>
      </div>

      <div id="b-achat" class="bloc active">
        <label>Item / Référence</label>
        <input id="a-item" placeholder="Ex: 100 Jeans Levi's 501">

        <div class="row">
          <div class="field">
            <label>Date</label>
            <input id="a-date" type="date">
          </div>
          <div class="field">
            <label>Montant (€)</label>
            <input id="a-montant" inputmode="decimal" placeholder="ex: 79,90">
            <div class="hint">Décimales : virgule ou point</div>
          </div>
        </div>

        <label>Fournisseur</label>
        <div class="select-wrap"><select id="a-fs"></select></div>
        <div class="hint">
          <button class="link-add" data-k="fournisseur" type="button" style="background:none;border:none;color:#6f57d3;text-decoration:underline;padding:0;cursor:pointer">+ ajouter</button>
          <span id="st-fournisseur" class="hint"></span>
        </div>
      </div>

      <div class="actions">
        <button id="submit"><span>+ Ajouter</span></button>
      </div>
    </main>
  </div>

  <script>
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbzF3P3AE1hcHuyFRZLnBS9eKtu0nz1jVyLxv8Ej0CbA78G-_ssXd2e-I9zgk58qqke46w/exec";
    const $ = s => document.querySelector(s);

    function todayISO(){
      const t = new Date();
      const y = t.getFullYear(), m = String(t.getMonth()+1).padStart(2,"0"), d = String(t.getDate()).padStart(2,"0");
      return `${y}-${m}-${d}`;
    }
    $("#a-date").value = todayISO();

    // gestion bouton ajout
    $("#submit").addEventListener("click", async (e)=>{
      e.preventDefault();
      const btn = $("#submit");
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span><span>Ajout en cours…</span>';

      try{
        const data = {
          type: $("#type").value,
          item: $("#a-item").value,
          dateISO: $("#a-date").value,
          montant: $("#a-montant").value.replace(",","."),
          fournisseur: $("#a-fs").value
        };
        const body = new URLSearchParams(Object.entries(data));
        const r = await fetch(ENDPOINT, {method:"POST", body});
        if(!r.ok) throw new Error("Erreur serveur");
        btn.innerHTML = "✅ Ajouté";
      }catch(err){
        btn.innerHTML = "❌ Erreur";
      }finally{
        setTimeout(()=>{ btn.innerHTML = "+ Ajouter"; btn.disabled=false; },1500);
      }
    });
  </script>
</body>
</html>
